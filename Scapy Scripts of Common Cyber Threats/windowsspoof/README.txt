This Scapy script monitors ICMP requests by checking if the packet is ICMP and if the ICMP type for the packet is 8 (ICMP echo request). After this it creates the reply packet which is built of the layers ip / icmp / data. This packet simulates a windows host by using a TTL of 128 hops, which is standard for Windows OS’s whilst Linux/Mac normally has a TTL of 64[5]. This traffic is sniffed, filtering to see only ICMP requests and only sends back the constructed ICMP packets. From the victim machine it will look normal, and as if it was from a Windows machine, but the Kali/attacker machine will print out the Source IP of the victim.

(Note for this to work properly, you should add an iptable to the attacker machine to stop the normal ICMP pings, so that it’s only the spoofed ICMP packets being sent)